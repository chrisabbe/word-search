<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Daily Word Search</title>

<style>
  :root{
    --teal:#008080;
    --teal-dark:#006a6a;
    --gold:#d8c178;
    --gold-soft:#efe4b4;
    --bg:#f5f6f7;
    --panel:#ffffff;
    --ink:#1e1e1e;
    --muted:#6b6b6b;
    --line:#b9b9b9;

    /* These are dynamically set by JS based on screen + grid size */
    --cell:24px;
    --gap:2px;
  }

  body{
    margin:0;
    background:var(--bg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--ink);
  }

  header{
    background:var(--teal);
    color:#fff;
    padding:14px 8px;
    text-align:center;
    border-bottom:3px solid var(--teal-dark);
  }
  header h1{
    margin:0;
    font-size:22px;
    letter-spacing:.4px;
  }
  header h2{
    margin:4px 0 0;
    font-size:15px;
    font-weight:600;
  }

  .wrap{
    max-width:980px;
    margin:0 auto;
    padding:10px;
  }

  .subtitle{
    text-align:center;
    color:var(--muted);
    font-size:13px;
    font-style:italic;
    margin:8px 0 14px;
  }

  .panel{
    background:var(--panel);
    border:1px solid #e2e2e2;
    border-radius:14px;
    padding:12px;
    box-shadow:0 2px 8px rgba(0,0,0,.04);
  }

  .layout{
    display:grid;
    grid-template-columns:auto 220px;
    gap:10px;
    align-items:start;
  }
  @media (max-width:760px){
    .layout{
      grid-template-columns:1fr;
    }
  }

  /* Grid container â€” no sideways scroll, drag-friendly */
  .gridWrap{
    width:100%;
    display:flex;
    justify-content:center;
    overflow:hidden;      /* <- prevents horizontal scroll */
    touch-action:none;    /* <- lets us fully control drag */
  }

  .grid{
    display:grid;
    gap:var(--gap);
    user-select:none;
    -webkit-user-select:none;
    touch-action:none;
  }

  .cell{
    width:var(--cell);
    height:var(--cell);
    display:flex;
    align-items:center;
    justify-content:center;
    background:#fff;
    border:1px solid var(--line);
    border-radius:6px;
    font-weight:800;
    font-size:calc(var(--cell) * 0.62);
    line-height:1;
  }

  .cell.prefound{
    background:var(--gold-soft);
    border-color:#b7a25a;
  }
  .cell.preview{
    background:#cfeeee;
    border-color:#6aa;
  }

  .words h3{
    margin:0 0 6px;
    color:var(--teal);
    font-size:16px;
  }
  .word{
    padding:4px 4px;
    font-weight:700;
    letter-spacing:.4px;
    border-radius:6px;
    font-size:14px;
  }
  .word.found{
    background:var(--gold-soft);
    text-decoration:line-through;
    color:#444;
  }

  .controls{
    margin-top:12px;
    text-align:center;
  }
  .btn{
    background:#fff;
    color:var(--teal);
    border:1px solid var(--teal);
    padding:9px 14px;
    border-radius:10px;
    font-weight:700;
    font-size:14px;
  }

  .toast{
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    bottom:16px;
    background:var(--teal);
    color:#fff;
    padding:8px 12px;
    border-radius:10px;
    font-size:13px;
    opacity:0;
    pointer-events:none;
    transition:opacity .25s;
    z-index:99;
  }
  .toast.show{ opacity:1; }
</style>
</head>

<body>
<header>
  <h1>Daily Word Search</h1>
  <h2>Morning Routine</h2>
</header>

<div class="wrap">
  <div class="subtitle">Drag across letters to highlight words. Progress saves automatically.</div>

  <div class="panel layout">
    <div class="gridWrap">
      <div id="grid" class="grid"></div>
    </div>

    <div class="words">
      <h3>Words to Find</h3>
      <div id="wordList"></div>
    </div>
  </div>

  <div class="controls">
    <button id="clearBtn" class="btn">Clear My Answers</button>
  </div>
</div>

<div id="toast" class="toast">Saved</div>

<script>
/* =========================
   CONFIG (supports multiple sizes)
========================= */
/* For future puzzles, you can change these two values, e.g. 15x15, 18x18, etc. */
const GRID_ROWS = 17;
const GRID_COLS = 17;

const WORDS = [
  "BRUSH","TEETH","COFFEE","SHOWER","ALARM","MIRROR","TOWEL","CEREAL",
  "TOOTHPASTE","SNOOZE","DRESS","SUNLIGHT","MAKEUP","SMOOTHIE","WAKE"
].map(w=>w.toUpperCase());

const LS_KEY = "ws_morningroutine_medium_v4";
const CLEAR_COOKIE = "ws_clear_v4";

/* =========================
   DETERMINISTIC RNG
========================= */
let seed = 195751;
function rand(){
  seed = (seed * 1103515245 + 12345) % 2147483648;
  return seed / 2147483648;
}
function choice(arr){ return arr[Math.floor(rand()*arr.length)]; }

/* 8 directions */
const DIRS = [
  {dr:1,dc:0},{dr:-1,dc:0},{dr:0,dc:1},{dr:0,dc:-1},
  {dr:1,dc:1},{dr:-1,dc:-1},{dr:-1,dc:1},{dr:1,dc:-1}
];

let grid = Array.from({length:GRID_ROWS},()=>Array(GRID_COLS).fill(""));

/* =========================
   GRID GENERATION
========================= */
function inBounds(r,c){ return r>=0 && r<GRID_ROWS && c>=0 && c<GRID_COLS; }

function canPlace(word,r,c,dr,dc){
  for(let i=0;i<word.length;i++){
    const rr=r+dr*i, cc=c+dc*i;
    if(!inBounds(rr,cc)) return false;
    const ch=grid[rr][cc];
    if(ch!=="" && ch!==word[i]) return false;
  }
  return true;
}

function placeWord(word){
  for(let t=0;t<2000;t++){
    const {dr,dc}=choice(DIRS);
    const minR = dr<0 ? word.length-1 : 0;
    const maxR = dr>0 ? GRID_ROWS-word.length : GRID_ROWS-1;
    const minC = dc<0 ? word.length-1 : 0;
    const maxC = dc>0 ? GRID_COLS-word.length : GRID_COLS-1;

    const r = Math.floor(rand()*(maxR-minR+1))+minR;
    const c = Math.floor(rand()*(maxC-minC+1))+minC;

    if(canPlace(word,r,c,dr,dc)){
      for(let i=0;i<word.length;i++){
        grid[r+dr*i][c+dc*i] = word[i];
      }
      return true;
    }
  }
  console.warn("Could not place:", word);
  return false;
}

function generatePuzzle(){
  [...WORDS].sort((a,b)=>b.length-a.length).forEach(w=>placeWord(w));
  const ABC="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  for(let r=0;r<GRID_ROWS;r++){
    for(let c=0;c<GRID_COLS;c++){
      if(grid[r][c]===""){
        grid[r][c] = ABC[Math.floor(rand()*26)];
      }
    }
  }
}

/* =========================
   DYNAMIC FIT (no horizontal scroll)
========================= */
function fitGridToScreen(){
  const wrap = document.querySelector(".gridWrap");
  if(!wrap) return;

  const rect = wrap.getBoundingClientRect();
  let avail = rect.width;

  /* Estimate padding/margins Google Sites adds inside iframe */
  const fudge = 24; // px to subtract (12px per side)
  avail = Math.max(100, avail - fudge);

  const gap = 2;
  const maxCell = 30;  // good for landscape / iPad
  const minCell = 16;  // small but legible on phones

  // base calculation
  let cell = Math.floor((avail - gap*(GRID_COLS-1)) / GRID_COLS);
  if(!Number.isFinite(cell) || cell < minCell) cell = minCell;
  if(cell > maxCell) cell = maxCell;

  // safety: if still too wide, shrink again
  let total = cell*GRID_COLS + gap*(GRID_COLS-1);
  if(total > rect.width){
    cell = Math.floor((rect.width - gap*(GRID_COLS-1)) / GRID_COLS);
    if(cell < minCell) cell = minCell;
  }

  document.documentElement.style.setProperty("--cell", cell + "px");
  document.documentElement.style.setProperty("--gap", gap + "px");
}

/* =========================
   RENDER
========================= */
const gridEl = document.getElementById("grid");
gridEl.style.gridTemplateColumns = `repeat(${GRID_COLS}, 1fr)`;

let cellEls = [];
let foundWords = new Set();
let foundCells = new Set();

function renderGrid(){
  gridEl.innerHTML = "";
  cellEls = [];
  for(let r=0;r<GRID_ROWS;r++){
    for(let c=0;c<GRID_COLS;c++){
      const div = document.createElement("div");
      div.className = "cell";
      div.textContent = grid[r][c];
      div.dataset.r = r;
      div.dataset.c = c;
      gridEl.appendChild(div);
      cellEls.push(div);
    }
  }
}

function renderWordList(){
  const box = document.getElementById("wordList");
  box.innerHTML = "";
  WORDS.forEach(w=>{
    const div = document.createElement("div");
    div.className = "word" + (foundWords.has(w) ? " found" : "");
    div.textContent = w;
    box.appendChild(div);
  });
}

function applyFound(){
  cellEls.forEach(el=>{
    const key = el.dataset.r + "," + el.dataset.c;
    el.classList.toggle("prefound", foundCells.has(key));
  });
}

/* =========================
   SELECTION LOGIC (drag)
========================= */
let selecting = false;
let startCell = null;
let previewCells = [];

function cellFromPoint(x,y){
  const el = document.elementFromPoint(x,y);
  if(!el) return null;
  if(el.classList.contains("cell")) return el;
  return el.closest(".cell");
}

function clearPreview(){
  previewCells.forEach(el=>el && el.classList.remove("preview"));
  previewCells = [];
}

function lineCells(r1,c1,r2,c2){
  const dr = Math.sign(r2-r1);
  const dc = Math.sign(c2-c1);
  if(!((dr===0 && dc!==0) || (dc===0 && dr!==0) || (Math.abs(r2-r1)===Math.abs(c2-c1)))){
    return [];
  }
  const out=[];
  let r=r1,c=c1; out.push([r,c]);
  while(r!==r2 || c!==c2){
    r+=dr; c+=dc;
    if(!inBounds(r,c)) return [];
    out.push([r,c]);
  }
  return out;
}

function previewTo(cell){
  clearPreview();
  if(!startCell || !cell) return;

  const r1=+startCell.dataset.r, c1=+startCell.dataset.c;
  const r2=+cell.dataset.r, c2=+cell.dataset.c;

  const coords = lineCells(r1,c1,r2,c2);
  coords.forEach(([r,c])=>{
    const el = gridEl.querySelector(`.cell[data-r="${r}"][data-c="${c}"]`);
    if(el && !el.classList.contains("prefound")){
      el.classList.add("preview");
    }
    previewCells.push(el);
  });
}

function previewWord(){
  return previewCells.map(el=>el?.textContent || "").join("");
}

function commitSelection(){
  const w = previewWord();
  if(!w) return;
  const rev = w.split("").reverse().join("");
  const hit = WORDS.find(x=>x===w || x===rev);
  if(!hit || foundWords.has(hit)) return;

  foundWords.add(hit);
  previewCells.forEach(el=>{
    if(!el) return;
    foundCells.add(el.dataset.r + "," + el.dataset.c);
  });

  renderWordList();
  applyFound();
  saveProgress();
  showToast(`Found: ${hit}`);
}

/* Pointer events (desktop + some mobile) */
gridEl.addEventListener("pointerdown", e=>{
  const cell = e.target.closest(".cell");
  if(!cell) return;
  selecting = true;
  startCell = cell;
  previewTo(cell);
  gridEl.setPointerCapture(e.pointerId);
});
gridEl.addEventListener("pointermove", e=>{
  if(!selecting) return;
  const cell = cellFromPoint(e.clientX, e.clientY);
  if(cell) previewTo(cell);
});
gridEl.addEventListener("pointerup", ()=>{
  if(!selecting) return;
  selecting = false;
  commitSelection();
  clearPreview();
  startCell = null;
});
gridEl.addEventListener("pointercancel", ()=>{
  selecting = false;
  clearPreview();
  startCell = null;
});

/* Touch fallback (reliable inside Google Sites) */
gridEl.addEventListener("touchstart", e=>{
  e.preventDefault();
  const t = e.touches[0];
  const cell = cellFromPoint(t.clientX, t.clientY);
  if(!cell) return;
  selecting = true;
  startCell = cell;
  previewTo(cell);
},{passive:false});

gridEl.addEventListener("touchmove", e=>{
  e.preventDefault();
  if(!selecting) return;
  const t = e.touches[0];
  const cell = cellFromPoint(t.clientX, t.clientY);
  if(cell) previewTo(cell);
},{passive:false});

gridEl.addEventListener("touchend", e=>{
  e.preventDefault();
  if(!selecting) return;
  selecting = false;
  commitSelection();
  clearPreview();
  startCell = null;
},{passive:false});

gridEl.addEventListener("touchcancel", e=>{
  e.preventDefault();
  selecting = false;
  clearPreview();
  startCell = null;
},{passive:false});

/* =========================
   SAVE / RESTORE
========================= */
function saveProgress(){
  const data = {
    foundWords:[...foundWords],
    foundCells:[...foundCells]
  };
  localStorage.setItem(LS_KEY, JSON.stringify(data));
}

function restoreProgress(){
  const raw = localStorage.getItem(LS_KEY);
  if(!raw) return;
  try{
    const d = JSON.parse(raw);
    (d.foundWords||[]).forEach(w=>foundWords.add(w));
    (d.foundCells||[]).forEach(k=>foundCells.add(k));
  }catch(e){}
}

/* Clear cookie helpers */
function setCookie(name,value){
  document.cookie = `${name}=${value}; path=/; SameSite=Lax`;
}
function getCookie(name){
  return document.cookie.split("; ").find(r=>r.startsWith(name+"="))?.split("=")[1] || "";
}
function delCookie(name){
  document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; SameSite=Lax`;
}

document.getElementById("clearBtn").addEventListener("click", ()=>{
  setCookie(CLEAR_COOKIE, "1");
  localStorage.removeItem(LS_KEY);
  location.reload();
});

if(getCookie(CLEAR_COOKIE)==="1"){
  localStorage.removeItem(LS_KEY);
  delCookie(CLEAR_COOKIE);
}

/* =========================
   TOAST
========================= */
let toastTimer=null;
function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.classList.remove("show"),1800);
}

/* =========================
   BOOT
========================= */
generatePuzzle();
fitGridToScreen();
renderGrid();
restoreProgress();
renderWordList();
applyFound();

/* Re-fit on resize & orientation changes */
let resizeTimer=null;
window.addEventListener("resize", ()=>{
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(()=>{
    fitGridToScreen();
  }, 120);
});
window.addEventListener("orientationchange", ()=>{
  setTimeout(()=>fitGridToScreen(), 200);
});
</script>
</body>
</html>
